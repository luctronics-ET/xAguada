{
  "network_topology": {
    "elementos": [
      {
        "id": "RCON",
        "tipo": "reservatorio",
        "nome": "Castelo Consumo",
        "alias": "CON",
        "portas": [
          { "id": "in01", "tipo": "entrada", "descricao": "Entrada principal IE" },
          { "id": "out_az", "tipo": "saida", "descricao": "Saída Área Azul" },
          { "id": "out_av", "tipo": "saida", "descricao": "Saída Área Vermelha" }
        ]
      },
      {
        "id": "RCAV",
        "tipo": "reservatorio",
        "nome": "Castelo Incêndio",
        "alias": "CAV",
        "portas": [
          { "id": "in01", "tipo": "entrada", "descricao": "Entrada B03" },
          { "id": "out_az", "tipo": "saida", "descricao": "Saída rede hidrantes" }
        ]
      },
      {
        "id": "RB03",
        "tipo": "reservatorio",
        "nome": "Reservatório B03",
        "alias": "B03",
        "local": "CB03 - Casa de Bombas N03",
        "portas": [
          { "id": "in01", "tipo": "entrada", "descricao": "Entrada IE01/IE02" },
          { "id": "out_con", "tipo": "saida", "descricao": "Saída para CON" },
          { "id": "out_cav", "tipo": "saida", "descricao": "Saída para CAV" }
        ]
      },
      {
        "id": "IE01",
        "tipo": "reservatorio",
        "nome": "Cisterna IE 01",
        "alias": "IE01",
        "portas": [
          { "id": "in01", "tipo": "entrada", "descricao": "Entrada IF" },
          { "id": "out_con", "tipo": "saida", "descricao": "Saída para CON" },
          { "id": "out_cav", "tipo": "saida", "descricao": "Saída para CAV" }
        ]
      },
      {
        "id": "IE02",
        "tipo": "reservatorio",
        "nome": "Cisterna IE 02",
        "alias": "IE02",
        "portas": [
          { "id": "in01", "tipo": "entrada", "descricao": "Entrada IF" },
          { "id": "out_con", "tipo": "saida", "descricao": "Saída para CON" },
          { "id": "out_cav", "tipo": "saida", "descricao": "Saída para CAV" }
        ]
      },
      {
        "id": "B03E",
        "tipo": "bomba",
        "nome": "Bomba Elétrica B03",
        "local": "CB03 - Casa de Bombas N03",
        "controle": "independente",
        "monitoramento": "nao_controlado_por_esp32",
        "portas": [
          { "id": "in", "tipo": "entrada", "descricao": "Entrada RB03" },
          { "id": "out", "tipo": "saida", "descricao": "Saída CON/CAV" }
        ],
        "parametros": {
          "potencia_kw": 5.0,
          "vazao_nominal_l_min": 500,
          "pressao_nominal_bar": 3.5,
          "tipo": "eletrica"
        }
      },
      {
        "id": "B03D",
        "tipo": "bomba",
        "nome": "Bomba Diesel B03",
        "local": "CB03 - Casa de Bombas N03",
        "controle": "independente",
        "monitoramento": "nao_controlado_por_esp32",
        "portas": [
          { "id": "in", "tipo": "entrada", "descricao": "Entrada RB03" },
          { "id": "out", "tipo": "saida", "descricao": "Saída CON/CAV" }
        ],
        "parametros": {
          "potencia_kw": 7.5,
          "vazao_nominal_l_min": 550,
          "pressao_nominal_bar": 4.0,
          "tipo": "diesel",
          "funcao": "backup/emergencia"
        }
      },
      {
        "id": "valv_entrada_ie",
        "tipo": "valvula",
        "nome": "Válvula Entrada IE→CON",
        "portas": [
          { "id": "in", "tipo": "entrada" },
          { "id": "out", "tipo": "saida" }
        ]
      },
      {
        "id": "valv_saida_az",
        "tipo": "valvula",
        "nome": "Válvula Saída Área Azul",
        "portas": [
          { "id": "in", "tipo": "entrada" },
          { "id": "out", "tipo": "saida" }
        ]
      },
      {
        "id": "valv_saida_av",
        "tipo": "valvula",
        "nome": "Válvula Saída Área Vermelha",
        "portas": [
          { "id": "in", "tipo": "entrada" },
          { "id": "out", "tipo": "saida" }
        ]
      }
    ],
    "conexoes": [
      {
        "id": "conn_01",
        "origem": "IE01.out_con",
        "destino": "RB03.in01",
        "ativo": true,
        "descricao": "IE01 → RB03"
      },
      {
        "id": "conn_01b",
        "origem": "IE02.out_con",
        "destino": "RB03.in01",
        "ativo": true,
        "descricao": "IE02 → RB03"
      },
      {
        "id": "conn_02",
        "origem": "RB03.out_con",
        "destino": "valv_entrada_ie.in",
        "ativo": true,
        "descricao": "RB03 → Válvula entrada CON"
      },
      {
        "id": "conn_03",
        "origem": "valv_entrada_ie.out",
        "destino": "RCON.in01",
        "ativo": true,
        "descricao": "Válvula → RCON entrada"
      },
      {
        "id": "conn_04",
        "origem": "RCON.out_az",
        "destino": "valv_saida_az.in",
        "ativo": true,
        "descricao": "RCON → Válvula Área Azul"
      },
      {
        "id": "conn_05",
        "origem": "RCON.out_av",
        "destino": "valv_saida_av.in",
        "ativo": true,
        "descricao": "RCON → Válvula Área Vermelha"
      },
      {
        "id": "conn_06",
        "origem": "RB03.out_cav",
        "destino": "RCAV.in01",
        "ativo": true,
        "via": ["B03E", "B03D"],
        "descricao": "RB03 → RCAV (via bombas B03E ou B03D)"
      }
    ],
    "regras_fluxo": {
      "descricao": "Água só flui se válvulas intermediárias estão ABERTAS e bombas estão ON",
      "condicoes": [
        {
          "rota": "IE01/IE02 → RB03 → RCON",
          "elementos_intermediarios": ["valv_entrada_ie"],
          "condicao": "valv_entrada_ie.estado == 'ABERTA'"
        },
        {
          "rota": "RCON → Área Azul",
          "elementos_intermediarios": ["valv_saida_az"],
          "condicao": "valv_saida_az.estado == 'ABERTA'"
        },
        {
          "rota": "RB03 → RCAV",
          "elementos_intermediarios": ["B03E", "B03D"],
          "condicao": "B03E.estado == 'ON' OR B03D.estado == 'ON'"
        }
      ]
    }
  }
}
